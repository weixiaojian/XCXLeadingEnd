(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/batch-send/index"],{"0403":function(e,a,t){"use strict";t.d(a,"b",(function(){return o})),t.d(a,"c",(function(){return d})),t.d(a,"a",(function(){return s}));var s={uniPopup:function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"e88b"))}},o=function(){var e=this,a=e.$createElement;e._self._c},d=[]},"06a7":function(e,a,t){},"2a84":function(e,a,t){"use strict";(function(e){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var s=function(){t.e("pages/order/components/agreement/index").then(function(){return resolve(t("7347"))}.bind(null,t)).catch(t.oe)},o=null,d={data:function(){return{addressDataJJ:{},addressDataSJ:[],addressDataSJCopy:[],editRecIndex:0,freight:"",agree:!0,pageId:"",realName:!1,optionType:"",newaddressId:"",tabIndex:0,specEmployee:"",specEmployeeCode:"",payment_type:"现金",mockList:this.$Mock.payment_type,teamModel:"",userData:{},disable:!1}},mounted:function(){var a=this,t=this;e.$on("selectAddress",(function(e){if(console.log(t.addressDataSJ),"0"==a.tabIndex)a.addressDataJJ=e,a.blurValue();else if("1"==a.tabIndex){var s=e;s.forEach((function(e){var a={};a.address=e,a.goodsInfo={goodsWeight:1,goodsName:"其他类型",goodsType:"",packingPiece:1,remark:"",goodsPayment:"现金"},t.addressDataSJ.push(a)}))}})),e.$on("packageinfo",(function(e){e.allSelect?(console.log("info",e.allSelect),a.addressDataSJ.forEach((function(a){a.goodsInfo.goodsWeight=e.goodsWeight,a.goodsInfo.goodsName=e.goodsName,a.goodsInfo.goodsType=e.goodsType,a.goodsInfo.packingPiece=e.packingPiece,a.goodsInfo.remark=e.remark}))):(a.addressDataSJ[a.editRecIndex].goodsInfo.goodsWeight=e.goodsWeight,a.addressDataSJ[a.editRecIndex].goodsInfo.goodsName=e.goodsName,a.addressDataSJ[a.editRecIndex].goodsInfo.goodsType=e.goodsType,a.addressDataSJ[a.editRecIndex].goodsInfo.packingPiece=e.packingPiece,a.addressDataSJ[a.editRecIndex].goodsInfo.remark=e.remark)})),e.$on("inputAddress",(function(e){"jjr"==a.newaddressId?t.addressDataJJ=e:"sjr"==a.newaddressId&&(t.addressDataSJ[a.editRecIndex].address=e)})),this.echoOrderData(),this.$nextTick((function(){console.log(this.userData.customerCode),"1"!=this.teamModel&&this.userData.customerCode&&(this.payment_type="月结")}))},components:{Agreement:s},beforeDestroy:function(){this.setStorageData()},onShow:function(){var e,a,t=this;this.addressDataJJ.phone&&t.blurValue();try{e=JSON.parse(this.$getStorageSync("sendsOrder"))}catch(s){console.log(s)}a=!e||0==Object.keys(e.addressDataJJ).length,0==Object.keys(this.addressDataJJ).length&&a&&t.getAddressDefault()},onLoad:function(){var a=this,t=a.$getStorageSync("userData");if("undefined"==typeof t)return e.showModal({title:"提示",content:"请先登录授权~",success:function(a){a.confirm&&e.switchTab({url:"/pages/tabbar/my/index?pageId=send"})}}),!1;try{this.userData=JSON.parse(t)}catch(s){console.log(s)}a.teamModel="1"==a.$getStorageSync("teamModel")?"1":"2",wx.setNavigationBarTitle({title:"下单寄件".concat("1"===a.$getStorageSync("teamModel")?"（团队）":"")}),a.setTeamInfo()},onUnload:function(){e.$off("selectAddress"),e.$off("packageinfo"),e.$off("addedservices"),e.$off("inputAddress")},onHide:function(){this.setStorageData()},methods:{setTeamInfo:function(){var a=this,t=a.$getStorageSync("teamInfo");console.log("teamInfo",t);var s=!!t&&t.groupId;if("1"!=a.teamModel&&!a.userData.customerCode)return s?(e.showModal({title:"提示",content:"请选择团队模式下单",success:function(t){t.confirm?e.switchTab({url:"/pages/tabbar/home/index?pageId=send"}):t.cancel&&(a.disable=!0)}}),!1):(e.showModal({title:"提示",content:"是否有合作网点，如有请绑定月结客户编码再下单。",success:function(a){a.confirm?e.navigateTo({url:"/pages/bind-monthly/index?pageId=send"}):a.cancel}}),!1)},getGoodsInfo:function(a,t){this.editRecIndex=a;var s={};s.type=t,"wpxx"==t&&(s.item={goodsName:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsName,remark:this.addressDataSJ[this.editRecIndex].goodsInfo.remark,goodsWeight:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsWeight,packingPiece:this.addressDataSJ[this.editRecIndex].goodsInfo.packingPiece,goodsType:this.addressDataSJ[this.editRecIndex].goodsInfo.goodsType},e.navigateTo({url:"/pages/order/packageinfo/index?pageId=sends&data="+JSON.stringify(s)}))},detele:function(a,t){var s=this;e.showModal({title:"移除提示",content:"您确定要移除"+a.address.name+"的信息？",success:function(e){e.confirm&&s.addressDataSJ.splice(t,1)}})},goRead:function(){this.$refs["showpopup1"].open()},confirmAgreement:function(){var e=this;e.$refs["showpopup1"].close(),e.agree=!0},blurValue:function(){var e=this,a=!!this.addressDataJJ&&this.addressDataJJ.phone;if(a){var t={phone:this.addressDataJJ.phone};e.$getByPhone(t).then((function(a){console.log(a),e.realName=a,e.hasTips=!a}))}},bindPickerChange:function(e){var a=e.detail.value;this.payment_type=this.$Mock.payment_type[a].name,console.log(this.payment_type)},realnameMethod:function(){var a={phone:this.addressDataJJ.phone};e.navigateTo({url:"/pages/myrealname/index?data="+JSON.stringify(a)})},getAddressDefault:function(){var e=this;e.$api.getAddressDefault().then((function(a){200==a.code&&null!=a.data&&(e.addressDataJJ=a.data)}))},checkboxChange:function(e){this.agree="agree"==e.detail.value,console.log(this.agree)},deleteRec:function(e){var a=this;a.addressDataSJ.splice(e,1)},newaddress:function(a){var t={type:"sends"};this.newaddressId=a.pageId,"jjr"==a.pageId?t.item=this.addressDataJJ:"sjr"==a.pageId&&(t.item=this.addressDataSJ[a.index].address,this.editRecIndex=a.index),e.navigateTo({url:"/pages/newaddress/index?pageId="+a.pageId+"&data="+JSON.stringify(t)})},submit:function(){var a=this,t=this;if(!t.disable){var s=this.$getStorageSync("teamInfo");"{}"!=JSON.stringify(this.addressDataJJ)?this.addressDataSJ.length?this.agree?(null!=o&&clearTimeout(o),o=setTimeout((function(){for(var o={},d=[],n=0;n<a.addressDataSJ.length;n++){if(""==a.addressDataSJ[n].address.name||void 0==a.addressDataSJ[n].address.name||null==a.addressDataSJ[n].address.name)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个收件人信息",duration:2e3});if(""==a.addressDataSJ[n].goodsWeight)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个重量信息",duration:2e3});if(""==a.addressDataSJ[n].goodsName)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个物品名称",duration:2e3});if(""==a.addressDataSJ[n].packingPiece)return void e.showToast({icon:"none",title:"请填写第"+(n+1)+"个数量",duration:2e3});o={sendCountry:"中国",sendProvince:a.addressDataJJ.provice,sendCity:a.addressDataJJ.city,sendCounty:a.addressDataJJ.country,sendTown:a.addressDataJJ.townName,sendManAddress:a.addressDataJJ.detailAddress,sendMan:a.addressDataJJ.name,sendManMobile:a.addressDataJJ.phone,sendManCompany:a.addressDataJJ.company,sendSite:"",sendSiteCode:"",acceptCountry:"中国",acceptProvince:a.addressDataSJ[n].address.provice,acceptCity:a.addressDataSJ[n].address.city,acceptCounty:a.addressDataSJ[n].address.country,acceptTown:a.addressDataSJ[n].address.townName,acceptManAddress:a.addressDataSJ[n].address.detailAddress,acceptMan:a.addressDataSJ[n].address.name,acceptManMobile:a.addressDataSJ[n].address.phone,acceptManCompany:a.addressDataSJ[n].address.company,packingPiece:a.addressDataSJ[n].goodsInfo.packingPiece,openId:a.$getStorageSync("token"),freight:0,remark:a.addressDataSJ[n].goodsInfo.remark,recManCode:"",goodsWeight:a.addressDataSJ[n].goodsInfo.goodsWeight,paymentType:a.payment_type,originalBillCode:"",goodsName:a.addressDataSJ[n].goodsInfo.goodsName,goodsPayment:0,dataFrom:"微信",recMan:"",goodsType:a.addressDataSJ[n].goodsInfo.goodsType},"1"==a.teamModel?(o.groupId=s.groupId,o.groupMember=s.nickName,o.sendSite=s.siteName,o.sendSiteCode=s.siteCode,o.customerCode=s.customerCode,o.customerName=s.customerName):a.userData.customerCode&&(o.customerCode=a.userData.customerCode,o.customerName=a.userData.customerName),d.push(o)}console.log("形成的批量订单",d),0!=d.length&&(e.showLoading({title:"正在下单,请等待"}),a.$api.saveOrderList(d).then((function(s){if(setTimeout((function(){e.hideLoading()}),2e3),console.log("正在下单,请等待",s),200==s.code)if(e.showToast({icon:"none",title:"成功了:"+s.data.successTotal+"条，失败了:"+s.data.errorTotal,duration:2e3}),s.data.errorList.length>0){var o=s.data.errorList;o.forEach((function(e,a){e.goodsWeight=e.goodsWeight||"",e.name=e.acceptMan||"",e.phone=e.acceptManMobile||"",e.provice=e.acceptProvince||"",e.city=e.acceptCity||"",e.country=e.acceptCounty||"",e.townName=e.acceptTown||"",e.detailAddress=e.acceptManAddress||""})),a.addressDataSJ=o}else setTimeout((function(){t.reset_order(),getApp().globalData.currentIndex=0,e.switchTab({url:"/pages/tabbar/inquire/index"})}),2e3)})))}),1500)):e.showToast({icon:"none",title:"请勾选快递协议"}):e.showToast({icon:"none",title:"收件信息请补充",duration:1500}):e.showToast({icon:"none",title:"请填写寄件人信息"})}},myaddress:function(a){var t={tabIndex:a};this.tabIndex=a,e.navigateTo({url:"/pages/myaddress/index?pageId=sends&data="+JSON.stringify(t)})},echoOrderData:function(){var e;try{e=JSON.parse(this.$getStorageSync("sendsOrder"))}catch(i){console.log(i)}if(e){var a=e,t=a.addressDataJJ,s=a.addressDataSJ,o=a.freight,d=a.paymentType,n=a.specEmployee,r=a.specEmployeeCode;0!=Object.keys(t).length&&(this.addressDataJJ=t),this.addressDataSJ=s,this.freight=o,this.payment_type=d,this.specEmployee=n,this.specEmployeeCode=r}},reset_order:function(){this.addressDataJJ={},this.addressDataSJ=[],this.freight="",this.payment_type="现金",this.specEmployee="",this.specEmployeeCode="",this.$setStorageSync("sendsOrder",{})},setStorageData:function(){var e={addressDataJJ:this.addressDataJJ,addressDataSJ:this.addressDataSJ,paymentType:this.payment_type};this.$setStorageSync("sendsOrder",JSON.stringify(e))}}};a.default=d}).call(this,t("543d")["default"])},"4fcc":function(e,a,t){"use strict";t.r(a);var s=t("0403"),o=t("d648");for(var d in o)"default"!==d&&function(e){t.d(a,e,(function(){return o[e]}))}(d);t("642c");var n,r=t("f0c5"),i=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,"4c5025b6",null,!1,s["a"],n);a["default"]=i.exports},"642c":function(e,a,t){"use strict";var s=t("06a7"),o=t.n(s);o.a},9098:function(e,a,t){"use strict";(function(e){t("5e56");s(t("66fd"));var a=s(t("4fcc"));function s(e){return e&&e.__esModule?e:{default:e}}e(a.default)}).call(this,t("543d")["createPage"])},d648:function(e,a,t){"use strict";t.r(a);var s=t("2a84"),o=t.n(s);for(var d in s)"default"!==d&&function(e){t.d(a,e,(function(){return s[e]}))}(d);a["default"]=o.a}},[["9098","common/runtime","common/vendor"]]]);